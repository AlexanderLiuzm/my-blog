(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{204:function(e,s,n){e.exports=n.p+"assets/img/diff_header_table_merge_target.b1e57475.png"},205:function(e,s,n){e.exports=n.p+"assets/img/diff_header_table_merge_r2andr.7d711d67.png"},236:function(e,s,n){"use strict";n.r(s);var t=n(0),a=Object(t.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[e._v("#")]),e._v(" 目标")]),e._v(" "),t("p",[e._v("这次VBA的目标就是把不同工作表内的不同表头（即列标题有所不同）的表格进行汇总到一张表内。")]),e._v(" "),t("p",[t("img",{attrs:{src:n(204),alt:"enter image description here"}})]),e._v(" "),t("p",[e._v("先来看下这张汇总表格有什么地方是值得注意的：")]),e._v(" "),t("ol",[t("li",[e._v("列标题与数据是一一对应的，来自哪个表的数据就对应行标题来自哪个表格")]),e._v(" "),t("li",[e._v("列标题汇总了所有的列标题（项目名称），避免了重复")]),e._v(" "),t("li",[e._v("数据填充在相应的单元格，没有数据的地方就留空")])]),e._v(" "),t("h1",{attrs:{id:"思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#思路"}},[e._v("#")]),e._v(" 思路")]),e._v(" "),t("p",[e._v("因为"),t("strong",[e._v("列标题")]),e._v("是汇总的，没有重复的，所以就先想到可以利用"),t("code",[e._v("字典")]),e._v("来进行汇总，同时排除了重复项。又因为数据要填充到相应的单元格，即要有对应的行号和列号，就选择用列标题的值和列标题对应的"),t("code",[e._v("item")]),e._v("进行标号，以确保数据能进入正确的单元格。利用一个循环找到操作一张表格的起始行号和结束行号，对第一列进行填充，以达到粘贴的数据与行标题是对应的效果。")]),e._v(" "),t("p",[e._v("简而言之，分为以下几步：")]),e._v(" "),t("ol",[t("li",[e._v("遍历工作表，取出不同的标题行名称")]),e._v(" "),t("li",[e._v("遍历每一列，把每一列的数据复制到合并表")]),e._v(" "),t("li",[e._v("命名对应的行标题")])]),e._v(" "),t("h1",{attrs:{id:"实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战"}},[e._v("#")]),e._v(" 实战")]),e._v(" "),t("h2",{attrs:{id:"遍历工作表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#遍历工作表"}},[e._v("#")]),e._v(" 遍历工作表")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('Set d = CreateObject("scripting.dictionary")\n\nSet newst = Sheets.Add\nnewst.Name = "合并"\nm = 2\nFor Each sh In Sheets\n    If sh.Name <> "合并" Then\n        For i = 1 To sh.UsedRange.Columns.Count\n            If Not d.exists(sh.Cells(1, i).Value) Then\n                d(sh.Cells(1, i).Value) = m\n                m = m + 1\n            End If\n        Next i\n    End If\nNext sh\n\nnewst.Range("A2") = "工作表"\nnewst.Range(Cells(1, 2), Cells(1, d.Count + 1)) = d.keys\n')])])]),t("p",[e._v("建立一个字典，对一个文档中的所有工作表进行遍历，对凡是名字不叫"),t("code",[e._v("合并")]),e._v("的表，取出首行的标题名称，检查是否在字典关键字中，若没有就添加到关键字，并指定"),t("code",[e._v("item")]),e._v("。"),t("code",[e._v("item")]),e._v("的命名是有讲究的，因为可以直接用来对应粘贴数据值。由于数据是从第二列开始粘贴的（第一列是显示对应的工作表名称），所以"),t("code",[e._v("item")]),e._v("的命名也从"),t("code",[e._v("2")]),e._v("开始。最后把字典中的关键字（不同的标题名称）赋值给合并表中的首行单元格。")]),e._v(" "),t("h2",{attrs:{id:"复制数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复制数据"}},[e._v("#")]),e._v(" 复制数据")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('For Each sh In Sheets\n    If sh.Name <> "合并" Then\n        r = newst.UsedRange.Rows.Count + 1\n        For i = 1 To sh.UsedRange.Columns.Count\n            sh.UsedRange.Columns(i).Offset(1).Copy newst.Cells(r, d(sh.Cells(1, i).Value))\n        Next i\n        r2 = newst.UsedRange.Rows.Count\n        newst.Range("A" & r & ":A" & r2) = sh.Name\n    End If\nNext sh\n')])])]),t("p",[e._v("同样使用循环遍历所有的工作表，只是将中间的字典部分进行了更换。把一张工作表中的数据都粘贴到合并表中，其中粘贴的内容要向下横移一行（offset），因为首行是标题行，不需要粘贴。")]),e._v(" "),t("p",[e._v("合并表中的标题行是唯一值，所以序列号与单张表中的标题行序列肯定是不匹配的，如何确保特定列的内容能准确无误的粘贴进相应的列当中呢？这就要用到我们之前为关键字指定的"),t("code",[e._v("item")]),e._v("，通过"),t("code",[e._v("keys")]),e._v("查找"),t("code",[e._v("item")]),e._v("的值，我们可以确定对应的列在合并表中是哪一列，以进行定位。")]),e._v(" "),t("p",[e._v("确定粘贴的行数就相对简单些，因为只要在使用过的行以下进行粘贴就好了。但是要注意的是由于我们是对一个文档中所有的工作表进行遍历循环，所以行数的增加（"),t("code",[e._v("r = newst.UsedRange.Rows.Count + 1")]),e._v("）应当放在遍历列循环的外面，否则每完成一列的粘贴，行数就会往下错，导致数据粘贴成阶梯形状（自己动手试试或者脑补吧 =_=）")]),e._v(" "),t("h2",{attrs:{id:"命名行标题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命名行标题"}},[e._v("#")]),e._v(" 命名行标题")]),e._v(" "),t("p",[t("img",{attrs:{src:n(205),alt:"enter image description here"}}),e._v("\n最后利用"),t("code",[e._v("r")]),e._v("和"),t("code",[e._v("r2")]),e._v("来确定遍历一个工作表的起始行和结束行，将这几行的第一列命名为相应的表名即可。")]),e._v(" "),t("h2",{attrs:{id:"全部代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全部代码"}},[e._v("#")]),e._v(" 全部代码")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('Sub combin()\nDim d As Object\nDim newst As Worksheet\nDim sh As Worksheet\nDim m\nDim r, r2\nDim i\n\n\nSet d = CreateObject("scripting.dictionary")\n\nSet newst = Sheets.Add\nnewst.Name = "合并"\nm = 2\nFor Each sh In Sheets\n    If sh.Name <> "合并" Then\n        For i = 1 To sh.UsedRange.Columns.Count\n            If Not d.exists(sh.Cells(1, i).Value) Then\n                d(sh.Cells(1, i).Value) = m\n                m = m + 1\n            End If\n        Next i\n    End If\nNext sh\n\nnewst.Range("A2") = "工作表"\nnewst.Range(Cells(1, 2), Cells(1, d.Count + 1)) = d.keys\n\nFor Each sh In Sheets\n    If sh.Name <> "合并" Then\n        r = newst.UsedRange.Rows.Count + 1\n        For i = 1 To sh.UsedRange.Columns.Count\n            sh.UsedRange.Columns(i).Offset(1).Copy newst.Cells(r, d(sh.Cells(1, i).Value))\n        Next i\n        r2 = newst.UsedRange.Rows.Count\n        newst.Range("A" & r & ":A" & r2) = sh.Name\n    End If\nNext sh\n\nSet d = Nothing\n\nEnd Sub\n\n')])])]),t("h1",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),t("p",[e._v("运用字典的时候可以巧妙的运用"),t("code",[e._v("keys")]),e._v("和"),t("code",[e._v("item")]),e._v("的对应关系进行单元格定位，这样可以减少很多的工作量并且非常有效的达到目的。")])])}),[],!1,null,null,null);s.default=a.exports}}]);