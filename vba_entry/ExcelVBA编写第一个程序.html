<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一起来学VBA</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.5c65f556.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.b8d0ed68.js" as="script"><link rel="preload" href="/my-blog/assets/js/2.16fc4d87.js" as="script"><link rel="preload" href="/my-blog/assets/js/11.dc4662bd.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.8e10b771.js"><link rel="prefetch" href="/my-blog/assets/js/12.66df6409.js"><link rel="prefetch" href="/my-blog/assets/js/13.2d325377.js"><link rel="prefetch" href="/my-blog/assets/js/14.f55b1da8.js"><link rel="prefetch" href="/my-blog/assets/js/15.6dbc8e41.js"><link rel="prefetch" href="/my-blog/assets/js/16.a0e2b506.js"><link rel="prefetch" href="/my-blog/assets/js/17.f25b4d50.js"><link rel="prefetch" href="/my-blog/assets/js/18.4b0b6022.js"><link rel="prefetch" href="/my-blog/assets/js/19.95508bb3.js"><link rel="prefetch" href="/my-blog/assets/js/20.1c5b9050.js"><link rel="prefetch" href="/my-blog/assets/js/21.ed2350eb.js"><link rel="prefetch" href="/my-blog/assets/js/22.32687073.js"><link rel="prefetch" href="/my-blog/assets/js/23.0ebed868.js"><link rel="prefetch" href="/my-blog/assets/js/24.4de088b5.js"><link rel="prefetch" href="/my-blog/assets/js/25.1e8b475b.js"><link rel="prefetch" href="/my-blog/assets/js/3.40123aec.js"><link rel="prefetch" href="/my-blog/assets/js/4.21d37fd2.js"><link rel="prefetch" href="/my-blog/assets/js/5.865d10fc.js"><link rel="prefetch" href="/my-blog/assets/js/6.ac699c54.js"><link rel="prefetch" href="/my-blog/assets/js/7.88812301.js"><link rel="prefetch" href="/my-blog/assets/js/8.535f8816.js"><link rel="prefetch" href="/my-blog/assets/js/9.475593e8.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.5c65f556.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><!----> <span class="site-name">一起来学VBA</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/my-blog/vba_entry/" class="nav-link router-link-active">Excel VBA</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="热门文章" class="dropdown-title"><span class="title">热门文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/vba_entry/ExcelVBA基本语法规则/" class="nav-link">VBA基本语法</a></li><li class="dropdown-item"><!----> <a href="/my-blog/vba_middle/利用ExcelVBA字典删除重复项/" class="nav-link">VBA字典的应用</a></li><li class="dropdown-item"><!----> <a href="/my-blog/vba_middle/二维表转一维表/" class="nav-link">二维表转一维表</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/AlexanderLiuzm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/my-blog/vba_entry/" class="nav-link router-link-active">Excel VBA</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="热门文章" class="dropdown-title"><span class="title">热门文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/vba_entry/ExcelVBA基本语法规则/" class="nav-link">VBA基本语法</a></li><li class="dropdown-item"><!----> <a href="/my-blog/vba_middle/利用ExcelVBA字典删除重复项/" class="nav-link">VBA字典的应用</a></li><li class="dropdown-item"><!----> <a href="/my-blog/vba_middle/二维表转一维表/" class="nav-link">二维表转一维表</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/AlexanderLiuzm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/my-blog/vba_entry/" class="sidebar-link">初级</a></li><li><a href="/my-blog/vba_middle/" class="sidebar-link">中级</a></li><li><a href="/my-blog/vba_high/" class="sidebar-link">高级</a></li><li><a href="/my-blog/" class="sidebar-link">首页</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>之前的课程中仅仅是对录制的代码进行微小改动，这节课中将用之前学到<code>对象</code>，<code>方法</code>和<code>属性</code>编写第一份VBA代码。</p> <h1 id="情景"><a href="#情景" class="header-anchor">#</a> 情景</h1> <p>文件夹中有<strong>三个Excel文件</strong>，它们各自包含若干<strong>工作表</strong>，每个工作表有若干行<strong>数据</strong>。现在要把每个工作表中的单元格复制到一份新的工作表中，由上到下依次排列。</p> <p><img src="/my-blog/assets/img/first_vba_program.d4d29c31.jpg" alt="场景描述"></p> <h1 id="操作"><a href="#操作" class="header-anchor">#</a> 操作</h1> <p>我们要用VBA实现的操作如下：</p> <ol><li><strong>选中第一个Excel文件</strong></li> <li><strong>选中文件中的第一张工作表</strong></li> <li>选择工作表中有内容的单元格</li> <li>复制粘贴到新的工作表中</li> <li><strong>再选中第二张工作表</strong></li> <li>选择工作表中有内容的单元格</li> <li>复制粘贴到新的工作表中</li> <li>……</li> <li>第一个文件全部复制完后，<strong>选择第二个Excel文件</strong></li> <li><strong>选中文件中的第一张工作表</strong></li> <li>选择工作表中有内容的单元格</li> <li>复制粘贴到新的工作表中</li> <li><strong>再选中第二张工作表</strong></li> <li>……</li></ol> <p>如此循环往复，一直到把三张表中的单元格全部复制到新表格中为止。</p> <h1 id="分析"><a href="#分析" class="header-anchor">#</a> 分析</h1> <p>在操作中可以看到有很多步骤是完全一样的（选择单元格可以用<code>UsedRange</code>这个对象，所以就不看做一个变量了），其中有少数几个变量：</p> <ol><li>选中的Excel文件（工作簿）</li> <li>选中的工作表</li> <li>第三个很容易忘记，粘贴到新工作表的时候要粘贴在之前的数据下方，所以新表格中<strong>开始粘贴的单元格</strong>也是变量</li></ol> <p>由此，我们可以设置三个循环：</p> <ol><li>依次调用工作簿</li> <li>依次调用工作表</li> <li>选中上次粘贴结束的下一行单元格</li></ol> <h1 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h1> <p>以下是对编辑的这份代码的详细注释（<code>'</code>后面的是注释）：</p> <div class="language- extra-class"><pre class="language-text"><code>Sub combin()
'为新的工作簿设定新的变量
    Set newbook = Workbooks.Add
    '将新的工作簿保存在当前工作簿同个文件夹内，并命名为“合并结果”
    newbook.SaveAs (ThisWorkbook.Path &amp; &quot;\合并结果.xlsx&quot;)
    '遍历所有的工作簿-一级循环
    For i = 1 To Workbooks.Count
        '对除了新建的工作簿以外的工作簿进行处理
        If Workbooks(i).Name &lt;&gt; newbook.Name Then
            '对选取的工作簿内的工作表进行依次引用-二级循环
            For j = 1 To Workbooks(i).Worksheets.Count
                '把所有有内容的单元格复制到新文件中
                Workbooks(i).Worksheets(j).UsedRange.Copy newbook.Worksheets(1).Range(&quot;A&quot; &amp; 1 + r)
                '清点经过粘贴后空行从哪一行起始，并赋值给r
                r = newbook.Worksheets(1).UsedRange.Rows.Count
            Next j
        End If
    Next i
End Sub
</code></pre></div><h1 id="错误总结"><a href="#错误总结" class="header-anchor">#</a> 错误总结</h1> <p>我在编写这份代码的时候出现了两处错误，导致运行的时候出现错误：</p> <ol><li>在第13行中错把<code>newbook</code>打成<code>newbooks</code>，之后再编写代码的时候要注意自己命名的变量，名字就算只打错一个字也会导致程序错误</li> <li>在第14行中的<code>Worksheets</code>后面忘记加<code>(1)</code>，这样VBA就无法识别到底要数哪个工作表中的行数，导致程序无法运行</li></ol> <blockquote><p>这是闻叨在网易云课堂上学习 方骥老师 的VBA课程的动手笔记，以上侵删</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/my-blog/assets/js/app.b8d0ed68.js" defer></script><script src="/my-blog/assets/js/2.16fc4d87.js" defer></script><script src="/my-blog/assets/js/11.dc4662bd.js" defer></script>
  </body>
</html>
