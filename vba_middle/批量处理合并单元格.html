<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>为什么要处理合并单元格 | 一起来学VBA</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.60ba14cb.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.2986e5e9.js" as="script"><link rel="preload" href="/my-blog/assets/js/2.16fc4d87.js" as="script"><link rel="preload" href="/my-blog/assets/js/6.ffa81f48.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.7b242d11.js"><link rel="prefetch" href="/my-blog/assets/js/11.e8193104.js"><link rel="prefetch" href="/my-blog/assets/js/12.42ae7acd.js"><link rel="prefetch" href="/my-blog/assets/js/13.2d325377.js"><link rel="prefetch" href="/my-blog/assets/js/14.f55b1da8.js"><link rel="prefetch" href="/my-blog/assets/js/15.6dbc8e41.js"><link rel="prefetch" href="/my-blog/assets/js/16.4f6d5025.js"><link rel="prefetch" href="/my-blog/assets/js/17.b34fcedc.js"><link rel="prefetch" href="/my-blog/assets/js/18.8cbade4a.js"><link rel="prefetch" href="/my-blog/assets/js/19.87ee01fa.js"><link rel="prefetch" href="/my-blog/assets/js/20.14ca77d3.js"><link rel="prefetch" href="/my-blog/assets/js/21.ed2350eb.js"><link rel="prefetch" href="/my-blog/assets/js/22.94f96a8d.js"><link rel="prefetch" href="/my-blog/assets/js/23.132b82a4.js"><link rel="prefetch" href="/my-blog/assets/js/24.4de088b5.js"><link rel="prefetch" href="/my-blog/assets/js/25.1e8b475b.js"><link rel="prefetch" href="/my-blog/assets/js/3.01ded201.js"><link rel="prefetch" href="/my-blog/assets/js/4.a07cd685.js"><link rel="prefetch" href="/my-blog/assets/js/5.df6d08e9.js"><link rel="prefetch" href="/my-blog/assets/js/7.88812301.js"><link rel="prefetch" href="/my-blog/assets/js/8.9efc655e.js"><link rel="prefetch" href="/my-blog/assets/js/9.3468bdcf.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.60ba14cb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><!----> <span class="site-name">一起来学VBA</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/my-blog/vba_entry/" class="nav-link">Excel VBA</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="热门文章" class="dropdown-title"><span class="title">热门文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/vba_entry/ExcelVBA基本语法规则/" class="nav-link">VBA基本语法</a></li><li class="dropdown-item"><!----> <a href="/my-blog/vba_middle/利用ExcelVBA字典删除重复项/" class="nav-link">VBA字典的应用</a></li><li class="dropdown-item"><!----> <a href="/my-blog/vba_middle/二维表转一维表/" class="nav-link">二维表转一维表</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/AlexanderLiuzm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/my-blog/vba_entry/" class="nav-link">Excel VBA</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="热门文章" class="dropdown-title"><span class="title">热门文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/vba_entry/ExcelVBA基本语法规则/" class="nav-link">VBA基本语法</a></li><li class="dropdown-item"><!----> <a href="/my-blog/vba_middle/利用ExcelVBA字典删除重复项/" class="nav-link">VBA字典的应用</a></li><li class="dropdown-item"><!----> <a href="/my-blog/vba_middle/二维表转一维表/" class="nav-link">二维表转一维表</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/AlexanderLiuzm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/my-blog/vba_entry/" class="sidebar-link">初级</a></li><li><a href="/my-blog/vba_middle/" class="sidebar-link">中级</a></li><li><a href="/my-blog/vba_high/" class="sidebar-link">高级</a></li><li><a href="/my-blog/" class="sidebar-link">首页</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="为什么要处理合并单元格"><a href="#为什么要处理合并单元格" class="header-anchor">#</a> 为什么要处理合并单元格</h1> <p>因为在数据处理当中一维的表格处理起来最为方便，可以汇总为二维的表格或者其他自己想要的表格。但矛盾就在这里，<em>合并单元格</em>大大降低了表格的可处理性，无论是筛选，排序还是统计（<code>sumif</code>），都会产生错误，对后续的处理操作带来极大的麻烦。因此在数据处理操作之前要对合并单元格进行处理。</p> <h1 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h1> <p>让合并的单元格都取消合并，并且都填充对应的值。</p> <p><img src="/my-blog/assets/img/batch_merge_cells_target.9c3edd8b.jpg" alt="enter image description here"></p> <h1 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h1> <h2 id="循环法"><a href="#循环法" class="header-anchor">#</a> 循环法</h2> <p>先把合并单元格进行恢复，取消合并。再对一列单元格进行逐一的检验。如果单元格内含有数据，那就不做处理；如果单元格内没有数据，那就把这个单元格的上一列的数据赋值给它。（举例来说，<em>令B5.Value = B6.Value</em>）但是为了不让这个循环一直进行下去，要给循环设定一个界限，就是常用的<code>Usedrange.rows.count</code>。</p> <h2 id="定位法"><a href="#定位法" class="header-anchor">#</a> 定位法</h2> <p>定位法相比循环法更为简单，先取消合并（此时会选中原先合并单元格的区域），然后定位空单元格，将这些单元格的值都等于他们的上一行的值就可以了。</p> <h1 id="实战"><a href="#实战" class="header-anchor">#</a> 实战</h1> <h2 id="循环法-2"><a href="#循环法-2" class="header-anchor">#</a> 循环法</h2> <h3 id="取消合并"><a href="#取消合并" class="header-anchor">#</a> 取消合并</h3> <p>利用<code>UnMerge</code>方法取消合并单元格。</p> <h3 id="建立循环"><a href="#建立循环" class="header-anchor">#</a> 建立循环</h3> <p>设定循环的界限<code>ActiveSheet.UsedRange.Rows.Count</code>。利用<code>offset()</code>函数，让空值的单元格得到上一行的单元格的值<code>= Range(&quot;A&quot; &amp; i).Offset(-1, 0).Value</code>。</p> <h3 id="代码块"><a href="#代码块" class="header-anchor">#</a> 代码块</h3> <div class="language- extra-class"><pre class="language-text"><code>Sub 循环法()
    Range(&quot;A:A&quot;).UnMerge
    For i = 2 To ActiveSheet.UsedRange.Rows.Count
        If Range(&quot;A&quot; &amp; i).Value = &quot;&quot; Then Range(&quot;A&quot; &amp; i).Value = Range(&quot;A&quot; &amp; i).Offset(-1, 0).Value
    Next i
End Sub
</code></pre></div><h2 id="定位法-2"><a href="#定位法-2" class="header-anchor">#</a> 定位法</h2> <h3 id="录制宏"><a href="#录制宏" class="header-anchor">#</a> 录制宏</h3> <p>先取消合并（此时会选中原先合并单元格的区域），直接按<strong>F5</strong>，会出现<em>定位</em>窗口。点击左下角的按钮，再选择<em>空值</em>，此时会选中空单元格。之后在上方的<em>数值栏</em>当中输入<code>=a2</code>，按下<strong>Ctrl + Enter</strong>，就会发现单元格的内容都自动填充好了。</p> <p><img src="/my-blog/assets/img/batch_merge_cells_locate.889cdb49.gif" alt="enter image description here"></p> <h3 id="选取录制好的宏代码"><a href="#选取录制好的宏代码" class="header-anchor">#</a> 选取录制好的宏代码</h3> <p>尽管录制下来的宏代码看似很长很复杂，但是其实前面的都是一些没什么用的参数设置，与我们刚刚进行的操作有实际相关联的就是最后三句。将这三句进行复制，建立新的宏，并进行改造。</p> <p><img src="/my-blog/assets/img/batch_merge_cells_record_macro.90947f25.png" alt="enter image description here"></p> <div class="language- extra-class"><pre class="language-text"><code>    Selection.UnMerge
    Selection.SpecialCells(xlCellTypeBlanks).Select
    Selection.FormulaR1C1 = &quot;=R[-1]C&quot;
</code></pre></div><h4 id="unmerge"><a href="#unmerge" class="header-anchor">#</a> UnMerge</h4> <p>这是<em>取消合并</em>的操作，在宏代码中显示为<code>UnMerge</code></p> <h4 id="specialcells-xlcelltypeblanks"><a href="#specialcells-xlcelltypeblanks" class="header-anchor">#</a> SpecialCells(xlCellTypeBlanks)</h4> <p>这是定位特殊单元格的语法，在这里我们定位的是<em>空值</em>，所以括号里的内容是<code>Blanks</code>。</p> <h4 id="formular1c1-r-1-c"><a href="#formular1c1-r-1-c" class="header-anchor">#</a> FormulaR1C1 = &quot;=R[-1]C&quot;</h4> <p>这是我们最后在数值栏当中输入的公式，令值等于上一行（<code>R[-1]</code>）单元格（C）的值，大致用法与<code>offset()</code>函数一致。</p> <h3 id="改造宏代码"><a href="#改造宏代码" class="header-anchor">#</a> 改造宏代码</h3> <p>这一部分就相对简单了，首先我们要把<code>Selection</code>改成<code>Range(&quot;A:A&quot;)</code>，也就是让Excel自己选择A列，不用再让我们人工选定A列。之后可以把A列的值再赋值给A列，这是为了让单元格里显示的是数值而不是<strong>公式</strong>。</p> <div class="language- extra-class"><pre class="language-text"><code>    Range(&quot;A:A&quot;).UnMerge
    Range(&quot;A:A&quot;).SpecialCells(xlCellTypeBlanks).FormulaR1C1 = &quot;=R[-1]C&quot;
    Range(&quot;A:A&quot;).Value = Range(&quot;A:A&quot;).Value
</code></pre></div><h3 id="全部代码"><a href="#全部代码" class="header-anchor">#</a> 全部代码</h3> <div class="language- extra-class"><pre class="language-text"><code>Sub 定位法()

    Range(&quot;A:A&quot;).UnMerge
    Range(&quot;A:A&quot;).SpecialCells(xlCellTypeBlanks).FormulaR1C1 = &quot;=R[-1]C&quot;
    Range(&quot;A:A&quot;).Value = Range(&quot;A:A&quot;).Value

End Sub
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/my-blog/assets/js/app.2986e5e9.js" defer></script><script src="/my-blog/assets/js/2.16fc4d87.js" defer></script><script src="/my-blog/assets/js/6.ffa81f48.js" defer></script>
  </body>
</html>
